<!doctype html>

<html>

<head>

<title>I MADE A FUN GAME</title>


<link rel="stylesheet" type="text/css" href="./main.css" />


</head>

<body>
  <div id="game">
    <div id="walkthrough-title">lets merc some bad guys</div>
    <div id="room"></div>
    <div id="living-room"></div>

    <img id="protag" src="player-facing-down.png" />
  </div>

<script>
  const roomElm = document.getElementById("room");
  const playerElm = document.getElementById("protag");
  const momElm = document.getElementById("mom");
  const titleElm = document.getElementById("walkthrough-title");


  let player = {x: 0, y: 0};

  let last_tick = Date.now();
  let delta_time = 0;
  let tick_num = 0;
  function tick() {

    delta_time= Date.now() - last_tick;
    last_tick = Date.now();
    tick_num++;


    updatePlayer(playerElm);


    window.requestAnimationFrame(tick);
  }


  const gameScale = 3;
  const tileSize = 16 * gameScale;
  // function loadRoom(room) {

  //   if (room == "bedroom") {
  //     roomElm.style.backgroundImage = "bedroom.png";

  //     let width = 128 * gameScale;
  //     let height = 96 * gameScale;

  //     roomElm.style.width = width + "px";
  //     roomElm.style.height = height + "px";
  //   }

  // }


  // x and y are tile numbers 
  function placePlayer(x, y) {
    playerElm.style.top = (y) + "px";
    playerElm.style.left = (x) + "px";

  }

  let isMoving = false;
  function walkPlayerRight() {

    if (isMoving) {
      // don't respond if we're in the middle of moving
      return;
    }

  }


  let playerSpeed = .1;
  let playerKeyVelocity = {x : 0, y: 0};
  let pressedKeys = {
      up: false,
      down: false,
      left: false,
      right: false
  }
  function updatePlayer(playerElm) {
    let velocity = {x : 0, y: 0};

    // grab input
    if (pressedKeys.right) {
        velocity.x += playerSpeed * delta_time;
    }
    if (pressedKeys.left) {
        velocity.x -= playerSpeed * delta_time;
    }
    if (pressedKeys.up) {
        velocity.y -= playerSpeed * delta_time;
    }
    if (pressedKeys.down) {
        velocity.y += playerSpeed * delta_time;
    }

    // move player on screen
    player.x = player.x + velocity.x;
    player.y = player.y + velocity.y

    playerElm.style.left= `${player.x}px`;
    playerElm.style.top= `${player.y}px`;

    // animate
    // we're standing still
    if (Math.abs(velocity.x) + Math.abs(velocity.y) < 0.01) {
      playerElm.src = "player-facing-down.png";

      
    // moving more vertical than horizontal
    } else if (Math.abs(velocity.y) > Math.abs(velocity.x)) {
      if (velocity.y > 0) {

        // console.log(Date.now());
        if ((Date.now() % 300) > 150) {
          playerElm.src = "player-walking-down.png";
        } else {
          playerElm.src = "player-facing-down.png";
        }
        playerElm.style.transform = "translate(-50%, -50%)";
      } else { // velocity.y < 0
        if ((Date.now() % 300) > 150) {
          playerElm.src = "player-walking-up.png";
        } else {
          playerElm.src = "player-facing-up.png";
        }
        playerElm.style.transform = "translate(-50%, -50%)";
      }

    }


    // moving more horizontal than vertical
    else {

      if (velocity.x > 0) {

        // animate
        if ((Date.now() % 300) > 150) {
          playerElm.src = "player-walking-left.png";
        } else {
          playerElm.src = "player-facing-left.png";
        }
        playerElm.style.transform = "translate(-50%, -50%) scaleX(-1)";
      } else { // velocity.x < 0
        if ((Date.now() % 300) > 150) {
          playerElm.src = "player-walking-left.png";
        } else {
          playerElm.src = "player-facing-left.png";
        }
        playerElm.style.transform = "translate(-50%, -50%)";
      }
    }


  }


  function randSound() {
    return sounds[Math.floor(Math.random() * sounds.length)];

  }


  let moveKeyPressed = false;
  function startGame() {

    //load bedroom
    //loadRoom("bedroom");

    // place player
    //placePlayer(300, 450);

    // init player
    player.x = 300;
    player.y = 450;
    playerElm.style.left = player.x + "px";
    playerElm.style.top = player.y + "px";



    // start input
    window.addEventListener("mousedown", e => {
      
      // LEFT MOUSE BUTTON
      if (e.button == 0) {
	      target = {x: e.pageX, y: e.pageY};
      }

      // RIGHT MOUSE BUTTON
      if (e.button == 2) {
      }

    });

    window.addEventListener("mouseup", e => {

      // LEFT MOUSE BUTTON
      if (e.button == 0) {
      }

      if (e.button == 2) {
      }

    });

    window.addEventListener("mousemove", e => {
    });

    window.addEventListener("keyup", e => {
	switch(e.code) {
	  case "KeyS":
    	  case "ArrowDown":
	    pressedKeys.down = false;
    	    break;
    	  case "KeyW":
    	  case "ArrowUp":
	    pressedKeys.up = false;
    	    break;
    	  case "KeyA":
    	  case "ArrowLeft":
	    pressedKeys.left = false;
    	    break;
    	  case "KeyD":
    	  case "ArrowRight":
	    pressedKeys.right = false;
    	    break;
	}
    });
    window.addEventListener("keydown", e => {

	switch(e.code) {
	  case "KeyS":
    	  case "ArrowDown":
	    pressedKeys.down = true;
    	    break;
    	  case "KeyW":
    	  case "ArrowUp":
	    pressedKeys.up = true;
    	    break;
    	  case "KeyA":
    	  case "ArrowLeft":
	    pressedKeys.left = true;
    	    break;
    	  case "KeyD":
    	  case "ArrowRight":
	    pressedKeys.right = true;
    	    break;
	}

    });

    // disable context menu on right click
    window.addEventListener("contextmenu", e => e.preventDefault());

    window.addEventListener("dragend", e => {

    });




    window.requestAnimationFrame(tick);
  }
  


  startGame();

</script>
</body>


</html>
